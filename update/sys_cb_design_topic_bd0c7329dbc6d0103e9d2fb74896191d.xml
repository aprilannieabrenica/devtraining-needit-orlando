<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="Get Password Reset Link">b10c7329dbc6d0103e9d2fb74896191a</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"f79dc117b6aa46dcbd22fdaf031702ca","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":"true"},"id":"f79dc117b6aa46dcbd22fdaf031702ca"}],"goals":[{"name":"Password Reset","trigger_id":"f79dc117b6aa46dcbd22fdaf031702ca","nodes":[{"type":"StartGoal","goal_id":"3533cf8523a74364838053ee776ce78b","greeting_msg":{"type":"String","mode":"string","value":""},"id":"75aee04cc7954ba296c89bac3f14f02d","name":"Start","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"TerminateGoal","goal_id":"3533cf8523a74364838053ee776ce78b","confirmation_msg":{"type":"String","mode":"string","value":""},"id":"eefea10ec7e44595a7a97380499a652e","name":"End","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.user_name = gs.getUserName();\n\t\tvaVars.is_authenticated = '' + (vaVars.user_name != 'guest');\n    return '';\n})()\n","id":"80263a6236994e6e9a367461388552b2","name":"Authentication","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'true';\n})()\n"},"id":"8556daf2219643749d06a861235a6f67","name":"Authenticated"},{"type":"Branch","label":"Not Authenticated","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.is_authenticated == 'false';\n})()\n"},"id":"82836eebf5b041fc9de3f5fb267cfff8","name":"Not Authenticated"}],"id":"14cc27fd094944388c1e025aefcc3fe6","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"InputPrompt","variable_id":"011f4c38d24b4d8ab8962d11adb312ab","message":{"type":"String","mode":"string","value":"gs.getMessageLang(\"Please enter your email address.\", vaContext.getRequesterLang())"},"nlu_entity_binding":{"type":"NLUEntityBinding","name":"email","allow_text_input":true,"use_confirmation_prompt":false},"optional":false,"id":"36bf755e6f894718a48ca7596585d9c6","name":"Email","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n\tvar gr = new GlideRecord('sys_user');\n\tgr.addActiveQuery();\n\tgr.addQuery('email', vaInputs.email);\n\tgr.query();\n\t\n\tvaVars.user_found = '' + gr.hasNext();\n\t\n    return '';\n})()\n","id":"bd3acfd68893404b9e417394fe35c6b3","name":"Find User","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"User Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.user_found == 'true';\n})()\n"},"id":"b32e195045b44060b7d417f582f579e9","name":"User Found"},{"type":"Branch","label":"User Not Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.user_found == 'false';\n})()\n"},"id":"067cdb827d8a497b86c7c26d5f22eaf8","name":"User Not Found"}],"id":"43f08d955f0347ba93fc1fcb643b5de3","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"InputPrompt","variable_id":"cf2a5b174a4f4ca8af3a27c733f70a16","message":{"type":"String","mode":"string","value":"gs.getMessageLang(\"I didn't find your email address. Would you like to enter another?\", vaContext.getRequesterLang())"},"nlu_entity_binding":{"type":"NLUEntityBinding","name":"","allow_text_input":false,"use_confirmation_prompt":true},"optional":false,"id":"fe22845302164aa49ac6adebf0fbd400","name":"Repeat Email","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Enter Email Again","expression":{"type":"Applicability","mode":"query","value":"repeat_email=true"},"id":"8b8dcb4882144cd4972d381ff8451238","name":"Enter Email Again"},{"type":"Branch","label":"Stop Entering Email","expression":{"type":"Applicability","mode":"query","value":"repeat_email="},"id":"e4b351a52a284a88b984e406b340d241","name":"Stop Entering Email"}],"id":"4248ff983d284a709ef7475929f24be4","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n    \n    function getUser() {\n        if (vaVars.user_name == 'guest') {\n            var gr = new GlideRecord('sys_user');\n            gr.addQuery('email', vaInputs.email);\n            gr.query();\n            gr.next(); \n            return gr.getUniqueValue();\n        }\n        else \n            return vaInputs.user;\n    }\n    \n    // Check if User is in a Password Process group\n    function checkIfUserIsInGroup(process, userId) {\n        var process_group = new GlideRecord('pwd_map_proc_to_group');\n        process_group.addQuery('process', process.getUniqueValue());\n        process_group.query();\n        \n        while(process_group.next()) {\n            var grmember = new GlideRecord('sys_user_grmember');\n            grmember.addQuery('user', userId);\n            grmember.addQuery('group', process_group.getValue('user_group'));\n            grmember.query();\n            \n            if(grmember.hasNext()) {\n                return true;\n            }\n        }\n        \n        return false;\n    }\n    \n    var gr = new GlideRecord('pwd_process');\n\tgr.addActiveQuery();\n\tgr.addQuery('public_access', true);\n\tgr.addQuery('enabled_on_chatbot', true);\n\tgr.query();\n\n    var results = [];\n    var index = 0;\n    var userId = getUser();\n    while(gr.next()) {\n        if (gr.getValue('apply_to_all_users') == '1' || checkIfUserIsInGroup(gr, userId)) {\n            results.push(\n                {\n                    'name': gr.getDisplayValue('name'),\n                    'value': '$pwd_reset.do?sysparm_url=' + gr.getValue('url_suffix')\n                }\n            )\n            index++;\n        }\n    }\n    vaVars.pwd_reset_links = JSON.stringify(results);\n\n    return '';\n})()\n","id":"16339e9dbacd4a06a77a778222c1c558","name":"Find Password Reset Links","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Links Not Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results.length == 0;\n})()\n"},"id":"37e375fdd901432cbe134d3e240ffa2d","name":"Links Not Found"},{"type":"Branch","label":"Links Found","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results.length &gt; 0;\n})()\n"},"id":"c4c6c79d3d4249b3bdf25a554e16e205","name":"Links Found"}],"id":"2793555ce1a443af95bb391a39fabcb8","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"LinkOutputPrompt","header":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return results[parseInt(vaVars.pwd_reset_index)].name;\n})()\n"},"label":{"type":"String","mode":"string","value":"gs.getMessageLang(\"Reset your password.\", vaContext.getRequesterLang())"},"url":{"type":"String","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    var baseURL = gs.getProperty('glide.servlet.uri');\n    return baseURL + '/' + results[parseInt(vaVars.pwd_reset_index)].value;\n})()\n"},"link_type":"single","multi_link_script":"","id":"c51860b2442c48fc89d9215de8470702","name":"Password Reset Link","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.pwd_reset_index = parseInt(vaVars.pwd_reset_index) + 1;\n    return '';\n})()\n","id":"c722d60ac1a04242a56326ee526b832b","name":"Increment Counter","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"No links left","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return parseInt(vaVars.pwd_reset_index) &gt;= results.length;\n})()\n"},"id":"6cb643e8893a43c5bc893cbc4d0f5f7d","name":"No links left"},{"type":"Branch","label":"Next link","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var results = JSON.parse(vaVars.pwd_reset_links);\n    return parseInt(vaVars.pwd_reset_index) &lt; results.length;\n})()\n"},"id":"4934fc16e9784c468d5aac34de4f63c4","name":"Next link"}],"id":"1414194e55334fa3bf952908ed3f2fab","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessageLang(\"Sorry, I can't reset your password. Please contact the service desk for help.\", vaContext.getRequesterLang())"},"id":"e1c7f94f941f49cf9c8d22ad0233e855","name":"Contact Support","goal_id":"3533cf8523a74364838053ee776ce78b","applicability":{"type":"Applicability","mode":"script","value":"true"}}],"edges":[{"type":"Edge","source_node_id":"14cc27fd094944388c1e025aefcc3fe6","target_node_id":"16339e9dbacd4a06a77a778222c1c558","branch_id":"8556daf2219643749d06a861235a6f67","id":"a7c7f84ec3b14fd9a36ac1bcfaf57eac","name":"8556daf2219643749d06a861235a6f67"},{"type":"Edge","source_node_id":"2793555ce1a443af95bb391a39fabcb8","target_node_id":"e1c7f94f941f49cf9c8d22ad0233e855","branch_id":"37e375fdd901432cbe134d3e240ffa2d","id":"df9c6d7a1dcf4a9e9b89682ad6d71a27","name":"37e375fdd901432cbe134d3e240ffa2d"},{"type":"Edge","source_node_id":"75aee04cc7954ba296c89bac3f14f02d","target_node_id":"80263a6236994e6e9a367461388552b2","id":"cb2799f2cdbb4271a133f65e17635e80"},{"type":"Edge","source_node_id":"80263a6236994e6e9a367461388552b2","target_node_id":"14cc27fd094944388c1e025aefcc3fe6","id":"41e79a5bde894a26b49f59b4523ff710"},{"type":"Edge","source_node_id":"14cc27fd094944388c1e025aefcc3fe6","target_node_id":"36bf755e6f894718a48ca7596585d9c6","branch_id":"82836eebf5b041fc9de3f5fb267cfff8","id":"fee55e60d2064357915e08ef20c157c9","name":"82836eebf5b041fc9de3f5fb267cfff8"},{"type":"Edge","source_node_id":"36bf755e6f894718a48ca7596585d9c6","target_node_id":"bd3acfd68893404b9e417394fe35c6b3","id":"268f44c210f64b5b967d4d39669c55db"},{"type":"Edge","source_node_id":"bd3acfd68893404b9e417394fe35c6b3","target_node_id":"43f08d955f0347ba93fc1fcb643b5de3","id":"79f85dc489e449dbb2fb6b9cddba869b"},{"type":"Edge","source_node_id":"43f08d955f0347ba93fc1fcb643b5de3","target_node_id":"16339e9dbacd4a06a77a778222c1c558","branch_id":"b32e195045b44060b7d417f582f579e9","id":"0939913200c345c29ba3bc7fa00f1d25","name":"b32e195045b44060b7d417f582f579e9"},{"type":"Edge","source_node_id":"43f08d955f0347ba93fc1fcb643b5de3","target_node_id":"fe22845302164aa49ac6adebf0fbd400","branch_id":"067cdb827d8a497b86c7c26d5f22eaf8","id":"528e87e6257b4f2d93b9e64311be21df","name":"067cdb827d8a497b86c7c26d5f22eaf8"},{"type":"Edge","source_node_id":"fe22845302164aa49ac6adebf0fbd400","target_node_id":"4248ff983d284a709ef7475929f24be4","id":"a049ce0aa0604feab440ef9b7d4fc68c"},{"type":"Edge","source_node_id":"4248ff983d284a709ef7475929f24be4","target_node_id":"36bf755e6f894718a48ca7596585d9c6","branch_id":"8b8dcb4882144cd4972d381ff8451238","id":"8069ead68a9e4d138ec8a506171791c6","name":"8b8dcb4882144cd4972d381ff8451238"},{"type":"Edge","source_node_id":"4248ff983d284a709ef7475929f24be4","target_node_id":"eefea10ec7e44595a7a97380499a652e","branch_id":"e4b351a52a284a88b984e406b340d241","id":"46a8af926c5d42d78880651bd43f672f","name":"e4b351a52a284a88b984e406b340d241"},{"type":"Edge","source_node_id":"16339e9dbacd4a06a77a778222c1c558","target_node_id":"2793555ce1a443af95bb391a39fabcb8","id":"517f104f594a4e179336fbeaaeadff97"},{"type":"Edge","source_node_id":"2793555ce1a443af95bb391a39fabcb8","target_node_id":"c51860b2442c48fc89d9215de8470702","branch_id":"c4c6c79d3d4249b3bdf25a554e16e205","id":"d3753cfcf5af4ecc832c39e00042908f","name":"c4c6c79d3d4249b3bdf25a554e16e205"},{"type":"Edge","source_node_id":"c51860b2442c48fc89d9215de8470702","target_node_id":"c722d60ac1a04242a56326ee526b832b","id":"8b37a22654a54845ace57ca93b379663"},{"type":"Edge","source_node_id":"c722d60ac1a04242a56326ee526b832b","target_node_id":"1414194e55334fa3bf952908ed3f2fab","id":"9eb560b1bbce4a1f8a75a7955ce44f21"},{"type":"Edge","source_node_id":"1414194e55334fa3bf952908ed3f2fab","target_node_id":"eefea10ec7e44595a7a97380499a652e","branch_id":"6cb643e8893a43c5bc893cbc4d0f5f7d","id":"e9e73d1897c74a929328e96a5a3a73a3","name":"6cb643e8893a43c5bc893cbc4d0f5f7d"},{"type":"Edge","source_node_id":"1414194e55334fa3bf952908ed3f2fab","target_node_id":"c51860b2442c48fc89d9215de8470702","branch_id":"4934fc16e9784c468d5aac34de4f63c4","id":"278b9d2e33e342dabc39dc31cdc06545","name":"4934fc16e9784c468d5aac34de4f63c4"},{"type":"Edge","source_node_id":"e1c7f94f941f49cf9c8d22ad0233e855","target_node_id":"eefea10ec7e44595a7a97380499a652e","id":"dd5f14322f3141c98ef5a0f03a83d9da"}],"id":"3533cf8523a74364838053ee776ce78b"}],"script_variables":[{"type":"String","name":"is_authenticated","value":{"type":"String","mode":"string","value":"false"},"id":"c03b59507239434e8448dd26530fedd6"},{"type":"String","name":"is_enrolled","value":{"type":"String","mode":"string","value":"false"},"id":"7bcaf5b2df0b496d92b983a700565ba4"},{"type":"String","name":"user_found","value":{"type":"String","mode":"string","value":"false"},"id":"524500d5aaae465c9dc55b18db96514f"},{"type":"String","name":"pwd_reset_links","id":"5d981cb187584a77acaada72e3800842"},{"type":"String","name":"pwd_reset_index","value":{"type":"String","mode":"string","value":"0"},"id":"c6fb18a3d5274201acebe743651ffd7e"},{"type":"String","name":"user_name","value":{"type":"String","mode":"string"},"id":"0d3de7a9a3da441ab4071807771a2008"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"528fb09d458e47218a51ca2f738af9eb"}],"glide_variables":[{"type":"String","name":"email","id":"011f4c38d24b4d8ab8962d11adb312ab"},{"type":"True/False","id":"cf2a5b174a4f4ca8af3a27c733f70a16","name":"repeat_email"},{"type":"Reference","table":"sys_user","id":"current-user","name":"user"}],"applicability":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !gs.hasRole('snc_external') || gs.hasRole('admin');\n})()\n"},"roles":["public"],"scope":"134450a0b3781300787162ac16a8dc1e","domain":"global","id":"27093a5edb741300cde2fd131d9619d5","name":"Get Password Reset Link","key_phrases":["locked out","password","forgot","reset"],"nlu_provider":"","nlu_model":"sn_itsm_nlu_ITSM_NLU_for_VA","nlu_model_label":"","nlu_intent":"GetPasswordResetLink","nlu_intent_label":"","flexible_conversation_switching":false,"design_category":"3efd22da0b203300a1b16c2367673a10","library":false}</design_definition>
        <design_topic_id>27093a5edb741300cde2fd131d9619d5</design_topic_id>
        <name>Get Password Reset Link</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-07-17 03:27:12</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>bd0c7329dbc6d0103e9d2fb74896191d</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_cb_design_topic_bd0c7329dbc6d0103e9d2fb74896191d</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-07-17 03:27:12</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
